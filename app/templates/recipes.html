{% extends "base.html" %}
{% block title %}Recipe Finder{% endblock %}

{% block content %}

<div class="max-w-6xl mx-auto px-6 pt-0 pb-16">

  {% if not logged_in %}
  <div class="auth-gate" data-aos="fade-up">
    <div class="auth-gate-icon">
      <i data-lucide="lock" class="w-6 h-6 text-amber-600"></i>
    </div>
    <h2 class="text-2xl font-bold mb-2">Sign in to access Recipe Finder</h2>
    <p class="text-surface-500 text-sm mb-6">Find recipes matching your nutritional targets and preferred ingredients.</p>
    <a href="/login" class="btn-primary inline-flex">
      <i data-lucide="log-in" class="w-4 h-4"></i> Sign In
    </a>
  </div>

  {% else %}

  <!-- Page header -->
  <div class="page-header" data-aos="fade-up">
    <span class="section-badge bg-amber-100 text-amber-700 mb-3">RECIPE FINDER</span>
    <h1>Find Recipes by Nutrition</h1>
    <p>Set your desired nutritional values and optional ingredients — we'll find matching recipes for you.</p>
  </div>

  <form id="custom-form" class="glass-card max-w-2xl mx-auto space-y-6" data-aos="fade-up" data-aos-delay="100">
    <!-- Sliders -->
    <div class="space-y-5" id="nutrition-sliders">
      <!-- Rendered by JS -->
    </div>

    <div class="grid sm:grid-cols-2 gap-5">
      <div class="input-group">
        <label for="c-count"><i data-lucide="hash" class="w-3 h-3 inline -mt-0.5 mr-1 text-surface-400"></i>Number of recipes</label>
        <select id="c-count" class="input">
          <option value="5">5</option><option value="10" selected>10</option><option value="15">15</option><option value="20">20</option>
        </select>
      </div>
      <div class="input-group">
        <label for="c-ingredients"><i data-lucide="list" class="w-3 h-3 inline -mt-0.5 mr-1 text-surface-400"></i>Ingredients <span class="text-surface-700/30 font-normal">(separated by ;)</span></label>
        <input id="c-ingredients" type="text" class="input" placeholder="Milk;eggs;butter…" />
      </div>
    </div>

    <button type="submit" class="btn-primary w-full justify-center">
      <i data-lucide="search" class="w-4 h-4"></i>
      <span>Find Recipes</span>
      <span id="custom-spinner" class="hidden"><svg class="animate-spin h-4 w-4 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/></svg></span>
    </button>
  </form>

  <!-- Results -->
  <div id="custom-results" class="hidden mt-12 space-y-12">
    <div id="custom-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>

    <!-- Nutrition sunburst chart -->
    <div id="custom-overview" class="hidden glass-card max-w-2xl mx-auto p-6">
      <h3 class="text-center text-lg font-bold mb-1 flex items-center justify-center gap-2">
        <i data-lucide="pie-chart" class="w-5 h-5 text-amber-500"></i>
        Nutrition Breakdown — Sunburst
      </h3>
      <p class="text-center text-xs text-surface-500 mb-4">Select a recipe to see the full macro &amp; micro nutrient breakdown.</p>
      <div class="flex items-center justify-center gap-3 mb-5">
        <label for="custom-recipe-select" class="text-sm font-medium">Recipe:</label>
        <select id="custom-recipe-select" class="input max-w-xs"></select>
      </div>
      <div id="chart-custom-pie" class="chart-container" style="height:440px"></div>
    </div>
  </div>

  {% endif %}
</div>

{% endblock %}
